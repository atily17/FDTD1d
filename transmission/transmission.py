import numpy as np
import scipy.constants
import matplotlib.pyplot as plt

class Transmission:
    def __init__(self):
        self.incident()
        self.transmission()
        self.skindepth()
        self.skindepthd()

    def incident(self):
        fmin = np.log10(1e7)
        fmax = np.log10(1e10)
        self.freqs=np.logspace(fmin, fmax, num=150+1)
        self.incident = np.array([5.01293530e-12-5.88424417e-15j, 5.01293497e-12-6.16155992e-15j,
            5.01293460e-12-6.45194513e-15j, 5.01293419e-12-6.75601575e-15j,
            5.01293375e-12-7.07441675e-15j, 5.01293326e-12-7.40782349e-15j,
            5.01293273e-12-7.75694317e-15j, 5.01293214e-12-8.12251632e-15j,
            5.01293150e-12-8.50531835e-15j, 5.01293079e-12-8.90616123e-15j,
            5.01293002e-12-9.32589518e-15j, 5.01292918e-12-9.76541052e-15j,
            5.01292825e-12-1.02256395e-14j, 5.01292723e-12-1.07075583e-14j,
            5.01292611e-12-1.12121891e-14j, 5.01292489e-12-1.17406023e-14j,
            5.01292355e-12-1.22939188e-14j, 5.01292208e-12-1.28733120e-14j,
            5.01292046e-12-1.34800110e-14j, 5.01291870e-12-1.41153027e-14j,
            5.01291676e-12-1.47805345e-14j, 5.01291463e-12-1.54771173e-14j,
            5.01291230e-12-1.62065288e-14j, 5.01290974e-12-1.69703161e-14j,
            5.01290694e-12-1.77700990e-14j, 5.01290387e-12-1.86075741e-14j,
            5.01290050e-12-1.94845176e-14j, 5.01289680e-12-2.04027895e-14j,
            5.01289275e-12-2.13643375e-14j, 5.01288831e-12-2.23712009e-14j,
            5.01288344e-12-2.34255154e-14j, 5.01287809e-12-2.45295170e-14j,
            5.01287224e-12-2.56855473e-14j, 5.01286582e-12-2.68960581e-14j,
            5.01285878e-12-2.81636168e-14j, 5.01285106e-12-2.94909116e-14j,
            5.01284259e-12-3.08807577e-14j, 5.01283331e-12-3.23361026e-14j,
            5.01282313e-12-3.38600327e-14j, 5.01281197e-12-3.54557800e-14j,
            5.01279974e-12-3.71267285e-14j, 5.01278632e-12-3.88764219e-14j,
            5.01277161e-12-4.07085705e-14j, 5.01275548e-12-4.26270595e-14j,
            5.01273779e-12-4.46359573e-14j, 5.01271840e-12-4.67395235e-14j,
            5.01269714e-12-4.89422186e-14j, 5.01267382e-12-5.12487130e-14j,
            5.01264826e-12-5.36638972e-14j, 5.01262023e-12-5.61928916e-14j,
            5.01258950e-12-5.88410581e-14j, 5.01255580e-12-6.16140105e-14j,
            5.01251885e-12-6.45176272e-14j, 5.01247833e-12-6.75580632e-14j,
            5.01243391e-12-7.07417629e-14j, 5.01238520e-12-7.40754741e-14j,
            5.01233179e-12-7.75662619e-14j, 5.01227323e-12-8.12215238e-14j,
            5.01220902e-12-8.50490049e-14j, 5.01213861e-12-8.90568146e-14j,
            5.01206141e-12-9.32534434e-14j, 5.01197677e-12-9.76477807e-14j,
            5.01188395e-12-1.02249133e-13j, 5.01178219e-12-1.07067246e-13j,
            5.01167061e-12-1.12112319e-13j, 5.01154826e-12-1.17395033e-13j,
            5.01141411e-12-1.22926569e-13j, 5.01126702e-12-1.28718632e-13j,
            5.01110574e-12-1.34783475e-13j, 5.01092890e-12-1.41133928e-13j,
            5.01073501e-12-1.47783416e-13j, 5.01052241e-12-1.54745996e-13j,
            5.01028930e-12-1.62036381e-13j, 5.01003371e-12-1.69669970e-13j,
            5.00975346e-12-1.77662883e-13j, 5.00944618e-12-1.86031989e-13j,
            5.00910927e-12-1.94794942e-13j, 5.00873986e-12-2.03970219e-13j,
            5.00833481e-12-2.13577154e-13j, 5.00789071e-12-2.23635978e-13j,
            5.00740377e-12-2.34167859e-13j, 5.00686988e-12-2.45194944e-13j,
            5.00628449e-12-2.56740399e-13j, 5.00564266e-12-2.68828461e-13j,
            5.00493894e-12-2.81484476e-13j, 5.00416736e-12-2.94734954e-13j,
            5.00332139e-12-3.08607615e-13j, 5.00239386e-12-3.23131443e-13j,
            5.00137691e-12-3.38336737e-13j, 5.00026194e-12-3.54255165e-13j,
            4.99903949e-12-3.70919823e-13j, 4.99769922e-12-3.88365290e-13j,
            4.99622978e-12-4.06627688e-13j, 4.99461876e-12-4.25744740e-13j,
            4.99285251e-12-4.45755833e-13j, 4.99091610e-12-4.66702078e-13j,
            4.98879317e-12-4.88626372e-13j, 4.98646579e-12-5.11573459e-13j,
            4.98391430e-12-5.35589995e-13j, 4.98111717e-12-5.60724602e-13j,
            4.97805081e-12-5.87027934e-13j, 4.97468936e-12-6.14552729e-13j,
            4.97100451e-12-6.43353866e-13j, 4.96696523e-12-6.73488412e-13j,
            4.96253757e-12-7.05015668e-13j, 4.95768431e-12-7.37997210e-13j,
            4.95236470e-12-7.72496913e-13j, 4.94653414e-12-8.08580978e-13j,
            4.94014378e-12-8.46317937e-13j, 4.93314019e-12-8.85778646e-13j,
            4.92546484e-12-9.27036265e-13j, 4.91705373e-12-9.70166213e-13j,
            4.90783683e-12-1.01524610e-12j, 4.89773755e-12-1.06235564e-12j,
            4.88667214e-12-1.11157649e-12j, 4.87454905e-12-1.16299214e-12j,
            4.86126823e-12-1.21668763e-12j, 4.84672039e-12-1.27274934e-12j,
            4.83078615e-12-1.33126464e-12j, 4.81333522e-12-1.39232147e-12j,
            4.79422542e-12-1.45600790e-12j, 4.77330168e-12-1.52241151e-12j,
            4.75039500e-12-1.59161876e-12j, 4.72532124e-12-1.66371411e-12j,
            4.69787994e-12-1.73877912e-12j, 4.66785304e-12-1.81689132e-12j,
            4.63500350e-12-1.89812287e-12j, 4.59907391e-12-1.98253910e-12j,
            4.55978496e-12-2.07019669e-12j, 4.51683398e-12-2.16114168e-12j,
            4.46989336e-12-2.25540708e-12j, 4.41860897e-12-2.35301020e-12j,
            4.36259863e-12-2.45394953e-12j, 4.30145059e-12-2.55820123e-12j,
            4.23472207e-12-2.66571505e-12j, 4.16193803e-12-2.77640980e-12j,
            4.08259000e-12-2.89016809e-12j, 3.99613531e-12-3.00683050e-12j,
            3.90199661e-12-3.12618894e-12j, 3.79956190e-12-3.24797925e-12j,
            3.68818521e-12-3.37187291e-12j, 3.56718799e-12-3.49746783e-12j,
            3.43586158e-12-3.62427814e-12j, 3.29347086e-12-3.75172302e-12j,
            3.13925935e-12-3.87911442e-12j, 2.97245625e-12-4.00564381e-12j,
            2.79228549e-12-4.13036796e-12j, 2.59797760e-12-4.25219376e-12j,
            2.38878446e-12-4.36986243e-12j, 2.16399786e-12-4.48193320e-12j,
            1.92297223e-12-4.58676698e-12j])


    def transmission(self):
        j = 1j
        freq=self.freqs
        mu1 = scipy.constants.mu_0
        eps1 = scipy.constants.epsilon_0
        mu2 = scipy.constants.mu_0
        eps2 = scipy.constants.epsilon_0
        sgm = 5.0E7
        z1 = np.sqrt(mu1/(eps1))
        z2 = np.sqrt(mu2/(eps2-sgm*j/(2*np.pi*freq)))
        T = (2*z2/(z2+z1))
        self.trans = T*self.incident

    def skindepth(self, zs = [1e-6, 2e-6]):
        mu0 = scipy.constants.mu_0
        delta = np.sqrt(2.0/(2.0*np.pi*self.freqs*mu0*5.0E7))
        self.depth = {}
        for z in zs:
            tran = self.trans*np.exp(-z/delta)
            self.depth["{a:.1e}".format(a=z)] = tran

    def skindepthd(self, zs = 0, zg=6e-6, n = 7, freq=1e9):
        z = np.linspace(zs, zg, n)
        fidx = (np.abs(self.freqs - freq)).argmin()
        f = self.freqs[fidx]
        t = self.trans[fidx]
        mu0 = scipy.constants.mu_0
        delta = np.sqrt(2.0/(2.0*np.pi*f*mu0*5.0E7))
        self.zz = z
        self.dd = t*np.exp(-z/delta)
        self.delta =delta
        self.Et = t

    def plotIncident(self):
        plt.xscale("log")
        plt.plot(self.freqs, np.abs(self.incident))
        plt.show()

    def plotTransmission(self):
        plt.xscale("log")
        plt.plot(self.freqs, np.abs(self.trans))
        plt.show()

    def plotSkinDepth(self, zs=[1e-6]):
        for k in self.depth:
            plt.plot(self.freqs, np.abs(self.depth[k]), label="{a:.1f}um".format(a=z))
        plt.xscale("log")
        plt.xlim([1e7,1e10])
        plt.legend()
        plt.show()


if __name__ == "__main__":
    trans = Transmission()
    print(trans.incident)
    print(trans.freqs)
    trans.plotSkinDepth([1e-6, 2e-6])


#trans.plotSkinDepth()

